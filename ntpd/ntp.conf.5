'\" t
.\"     Title: ntp.conf
.\"    Author: [FIXME: author] [see http://docbook.sf.net/el/author]
.\" Generator: DocBook XSL Stylesheets v1.76.1 <http://docbook.sf.net/>
.\"      Date: 06/04/2016
.\"    Manual: \ \&
.\"    Source: \ \&
.\"  Language: English
.\"
.TH "NTP\&.CONF" "5" "06/04/2016" "\ \&" "\ \&"
.\" -----------------------------------------------------------------
.\" * Define some portability stuff
.\" -----------------------------------------------------------------
.\" ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
.\" http://bugs.debian.org/507673
.\" http://lists.gnu.org/archive/html/groff/2009-02/msg00013.html
.\" ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
.ie \n(.g .ds Aq \(aq
.el       .ds Aq '
.\" -----------------------------------------------------------------
.\" * set default formatting
.\" -----------------------------------------------------------------
.\" disable hyphenation
.nh
.\" disable justification (adjust text to left margin only)
.ad l
.\" -----------------------------------------------------------------
.\" * MAIN CONTENT STARTS HERE *
.\" -----------------------------------------------------------------
.SH "NAME"
ntp.conf \- Network Time Protocol (NTP) daemon configuration file format
.SH "SYNOPSIS"
.sp
.SH "DESCRIPTION"
.sp
The {ntpconf} configuration file is read at initial startup by the ntpd(8) daemon in order to specify the synchronization sources, modes and other related information\&. Usually, it is installed in the /etc directory, but could be installed elsewhere (see the daemon\(cqs \-c command line option)\&.
.sp
The file format is similar to other UNIX configuration files\&. Comments begin with a \(oq#\(cq character and extend to the end of the line; blank lines are ignored\&. Configuration commands consist of an initial keyword followed by a list of arguments, some of which may be optional, separated by whitespace\&. Commands may not be continued over multiple lines\&. Arguments may be host names, host addresses written in numeric, dotted\-quad form, integers, floating point numbers (when specifying times in seconds) and text strings\&.
.sp
The rest of this page describes the configuration and control options\&. The "Notes on Configuring NTP and Setting up an NTP Subnet" page (available as part of the HTML documentation provided under `/usr/share/doc/ntp) contains an extended discussion of these options\&. In addition to the discussion of general \fIConfiguration Options\fR, there are sections describing the following supported functionality and the options used to control it:
.sp
.RS 4
.ie n \{\
\h'-04'\(bu\h'+03'\c
.\}
.el \{\
.sp -1
.IP \(bu 2.3
.\}
Authentication Support
.RE
.sp
.RS 4
.ie n \{\
\h'-04'\(bu\h'+03'\c
.\}
.el \{\
.sp -1
.IP \(bu 2.3
.\}
Monitoring Support
.RE
.sp
.RS 4
.ie n \{\
\h'-04'\(bu\h'+03'\c
.\}
.el \{\
.sp -1
.IP \(bu 2.3
.\}
Access Control Support
.RE
.sp
.RS 4
.ie n \{\
\h'-04'\(bu\h'+03'\c
.\}
.el \{\
.sp -1
.IP \(bu 2.3
.\}
Automatic NTP Configuration Options
.RE
.sp
.RS 4
.ie n \{\
\h'-04'\(bu\h'+03'\c
.\}
.el \{\
.sp -1
.IP \(bu 2.3
.\}
Reference Clock Support
.RE
.sp
.RS 4
.ie n \{\
\h'-04'\(bu\h'+03'\c
.\}
.el \{\
.sp -1
.IP \(bu 2.3
.\}
Miscellaneous Options
.RE
.sp
Following these is a section describing \fIMiscellaneous Options\fR\&. While there is a rich set of options available, the only required option is one or more pool, server, peer, broadcast or manycastclient commands\&.
.SH "CONFIGURATION SUPPORT"
.sp
Following is a description of the configuration commands in NTPv4\&. There are two classes of commands, association commands that configure a persistent association with a remote server or peer or reference clock, and auxiliary commands that specify environmental variables that control various related operations\&.
.SS "Association Commands"
.sp
The various modes are determined by the command keyword and the type of the required IP address\&. Addresses are classed by type as (s) a remote server or peer (IPv4 class A, B and C), (b) the broadcast address of a local interface, (m) a multicast address (IPv4 class D), or (r) a reference clock address (127\&.127\&.x\&.x)\&. For type m addresses the IANA has assigned the multicast group address IPv4 224\&.0\&.1\&.1 and IPv6 ff05::101 (site local) exclusively to NTP, but other nonconflicting addresses can be used\&.
.sp
Note that only those options applicable to each command are listed below\&. Use of options not listed may not be caught as an error, but may result in some weird and even destructive behavior\&.
.sp
If the Basic Socket Interface Extensions for IPv6 (RFC\-2553) is detected, support for the IPv6 address family is generated in addition to the default support of the IPv4 address family\&. In a few cases, including the reslist billboard generated by ntpq, IPv6 addresses are automatically generated\&. IPv6 addresses can be identified by the presence of colons ":" in the address field\&. IPv6 addresses can be used almost everywhere where IPv4 addresses can be used, with the exception of reference clock addresses, which are always IPv4\&.
.sp
Note that in contexts where a host name is expected, a \(oq\-4`or `\-\-ipv4` qualifier preceding the host name forces DNS resolution to the IPv4 namespace, while a \-6 or `\-\-ipv6\(cq qualifier forces DNS resolution to the IPv6 namespace\&. See IPv6 references for the equivalent classes for that address family\&.
.SS "Association Options"
.SS "Association Auxiliary Commands"
.SH "AUTHENTICATION COMMANDS"
.SH "MONITORING SUPPORT"
.sp
ntpd(8) includes a comprehensive monitoring facility suitable for continuous, long term recording of server and client timekeeping performance\&. See the statistics command below for a listing and example of each type of statistics currently supported\&. Statistic files are managed using file generation sets and scripts in the \&./scripts directory of this distribution\&. Using these facilities and UNIX cron(8) jobs, the data can be automatically summarized and archived for retrospective analysis\&.
.SS "Monitoring Commands"
.SH "ACCESS CONTROL SUPPORT"
.sp
The ntpd(8) daemon implements a general purpose address/mask based restriction list\&. The list contains address/match entries sorted first by increasing address values and and then by increasing mask values\&. A match occurs when the bitwise AND of the mask and the packet source address is equal to the bitwise AND of the mask and address in the list\&. The list is searched in order with the last match found defining the restriction flags associated with the entry\&. Additional information and examples can be found in the "Notes on Configuring NTP and Setting up a NTP Subnet" page (available as part of the HTML documentation provided in `/usr/share/doc/ntp`_)\&.
.sp
The restriction facility was implemented in conformance with the access policies for the original NSFnet backbone time servers\&. Later the facility was expanded to deflect cryptographic and clogging attacks\&. While this facility may be useful for keeping unwanted or broken or malicious clients from congesting innocent servers, it should not be considered an alternative to the NTP authentication facilities\&. Source address based restrictions are easily circumvented by a determined cracker\&.
.sp
Clients can be denied service because they are explicitly included in the restrict list created by the restrict command or implicitly as the result of cryptographic or rate limit violations\&. Cryptographic violations include certificate or identity verification failure; rate limit violations generally result from defective NTP implementations that send packets at abusive rates\&. Some violations cause denied service only for the offending packet, others cause denied service for a timed period and others cause the denied service for an indefinite period\&. When a client or network is denied access for an indefinite period, the only way at present to remove the restrictions is by restarting the server\&.
.SS "The Kiss\-of\-Death Packet"
.sp
Ordinarily, packets denied service are simply dropped with no further action except incrementing statistics counters\&. Sometimes a more proactive response is needed, such as a server message that explicitly requests the client to stop sending and leave a message for the system operator\&. A special packet format has been created for this purpose called the "kiss\-of\-death" (KoD) packet\&. KoD packets have the leap bits set unsynchronized and stratum set to zero and the reference identifier field set to a four\-byte ASCII code\&. If the noserve or notrust flag of the matching restrict list entry is set, the code is "DENY"; if the limited flag is set and the rate limit is exceeded, the code is "RATE"\&. Finally, if a cryptographic violation occurs, the code is "CRYP"\&.
.sp
A client receiving a KoD performs a set of sanity checks to minimize security exposure, then updates the stratum and reference identifier peer variables, sets the access denied (BOGON4) bit in the peer flash variable and sends a message to the log\&. As long as the BOGON4 bit is set, the client will send no further packets to the server\&. The only way at present to recover from this condition is to restart the protocol at both the client and server\&. This happens automatically at the client when the association times out\&. It will happen at the server only if the server operator cooperates\&.
.SH "ACCESS CONTROL COMMANDS"
.SH "AUTOMATIC NTP CONFIGURATION OPTIONS"
.SS "Manycasting"
.sp
For a detailed description of manycast operation, see the "Server Discovery" page (available as part of the HTML documentation provided in /usr/share/doc/{ntp})\&.
.SS "Manycast Options"
.PP
tos [ceiling \fIceiling\fR | cohort { 0 | 1 } | floor \fIfloor\fR | minclock \fIminclock\fR | minsane \fIminsane\fR]
.RS 4
This command affects the clock selection and clustering algorithms\&. It can be used to select the quality and quantity of peers used to synchronize the system clock and is most useful in manycast mode\&. The variables operate as follows:
.PP
ceiling \fIceiling\fR
.RS 4
Peers with strata above
\fIceiling\fR
will be discarded if there are at least
\fIminclock\fR
peers remaining\&. This value defaults to 15, but can be changed to any number from 1 to 15\&.
.RE
.PP
cohort {0 | 1 }
.RS 4
This is a binary flag which enables (0) or disables (1) manycast server replies to manycast clients with the same stratum level\&. This is useful to reduce implosions where large numbers of clients with the same stratum level are present\&. The default is to enable these replies\&.
.RE
.PP
floor \fIfloor\fR
.RS 4
Peers with strata below
\fIfloor\fR
will be discarded if there are at least
\fIminclock\fR
peers remaining\&. This value defaults to 1, but can be changed to any number from 1 to 15\&.
.RE
.PP
minclock \fIminclock\fR
.RS 4
The clustering algorithm repeatedly casts out outlier associations until no more than
\fIminclock\fR
associations remain\&. This value defaults to 3, but can be changed to any number from 1 to the number of configured sources\&.
.RE
.PP
minsane \fIminsane\fR
.RS 4
This is the minimum number of candidates available to the clock selection algorithm in order to produce one or more truechimers for the clustering algorithm\&. If fewer than this number are available, the clock is undisciplined and allowed to run free\&. The default is 1 for legacy purposes\&. However, according to principles of Byzantine agreement,
\fIminsane\fR
should be at least 4 in order to detect and discard a single falseticker\&.
.RE
.RE
.PP
ttl \fIhop\fR \&.\&.\&.
.RS 4
This command specifies a list of TTL values in increasing order, up to 8 values can be specified\&. In manycast mode these values are used in turn in an expanding\-ring search\&. The default is eight multiples of 32 starting at 31\&.
.RE
.SH "REFERENCE CLOCK SUPPORT"
.sp
For a detailed description of reference\-clock configuration, see the "Reference Clock Drivers" page (available as part of the HTML documentation provided in /usr/share/doc/{ntp})\&.
.SH "REFERENCE CLOCK COMMANDS"
.SH "MISCELLANEOUS OPTIONS"
.SH "FILES"
.PP
/etc/ntp\&.conf
.RS 4
the default name of the configuration file
.RE
.PP
\fIntp\&.keys\fR
.RS 4
private MD5 keys
.RE
.PP
\fIntpkey\fR
.RS 4
RSA private key
.RE
.PP
\fIntpkey_host\fR
.RS 4
RSA public key
.RE
.PP
\fIntp_dh\fR
.RS 4
Diffie\-Hellman agreement parameters
.RE
.SH "EXIT STATUS"
.sp
One of the following exit values will be returned:
.PP
0 (EXIT_SUCCESS)
.RS 4
Successful program execution\&.
.RE
.PP
1 (EXIT_FAILURE)
.RS 4
The operation failed or the command syntax was not valid\&.
.RE
.SH "SEE ALSO"
.sp
ntpd(8), ntpq(1)\&.
.sp
In addition to the manual pages provided, comprehensive documentation is available on the world wide web at http://www\&.ntpsec\&.org\&. A snapshot of this documentation is available in HTML format in /usr/share/doc/{ntp}\&. David L\&. Mills, \fINetwork Time Protocol (Version 4)\fR, RFC5905
.SH "BUGS"
.sp
The syntax checking is not picky; some combinations of ridiculous and even hilarious options and modes may not be detected\&.
.sp
The \fIntpkey_host\fR files are really digital certificates\&. These should be obtained via secure directory services when they become universally available\&.
