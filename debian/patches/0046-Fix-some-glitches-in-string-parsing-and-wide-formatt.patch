From 2a991041ad4b0da7175c5fc78aa48cc239714351 Mon Sep 17 00:00:00 2001
From: "Eric S. Raymond" <esr@thyrsus.com>
Date: Sun, 27 Nov 2016 12:35:12 -0500
Subject: [PATCH 046/268] Fix some glitches in string parsing and wide
 formatting.

---
 pylib/packet.py | 2 +-
 pylib/util.py   | 4 ++--
 2 files changed, 3 insertions(+), 3 deletions(-)

diff --git a/pylib/packet.py b/pylib/packet.py
index 1f2ae76..44a4d1e 100644
--- a/pylib/packet.py
+++ b/pylib/packet.py
@@ -1110,7 +1110,7 @@ class ControlSession:
             if c == '"':
                 response = response + c
                 instring = not instring
-            if instring and c == ',':
+            elif instring and c == ',':
                 response = response + "\xae"
             elif polyord(c) > 0 and polyord(c) < 127:
                 response = response + c
diff --git a/pylib/util.py b/pylib/util.py
index 85ad43d..a530463 100644
--- a/pylib/util.py
+++ b/pylib/util.py
@@ -87,14 +87,14 @@ class PeerSummary:
         # By default, the peer spreadsheet layout is designed so lines just
         # fit in 80 characters. This tells us how much extra horizontal space
         # we have available on a wider terminal emulator.
-        self.horizontal_slack = (termwidth or 80) - 80
+        self.horizontal_slack = min((termwidth or 80) - 80, 24)
         # Peer spreadsheet column widths. The reason we cap extra
         # width used at 24 is that on very wide displays, slamming the
         # non-hostname fields all the way to the right produces a huge
         # river that makes the entries difficult to read as wholes.
         # This choice caps the peername field width at that of the longest
         # possible IPV6 numeric address.
-        self.namewidth = 15 + min(self.horizontal_slack, 24)
+        self.namewidth = 15 + self.horizontal_slack
         self.refidwidth = 15
         # Compute peer spreadsheet headers 
         self.__remote = "     remote    ".ljust(self.namewidth)
-- 
2.7.4

