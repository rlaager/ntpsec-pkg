From c1668bfd26ed90cbfe0c77de2c11537c1c9ad94e Mon Sep 17 00:00:00 2001
From: "Eric S. Raymond" <esr@thyrsus.com>
Date: Thu, 24 Nov 2016 08:27:40 -0500
Subject: [PATCH 003/268] Added a release-shipper script.

---
 devel/README  |  3 +++
 devel/release | 47 +++++++++++++++++++++++++++++++++++++++++++++++
 2 files changed, 50 insertions(+)
 create mode 100755 devel/release

diff --git a/devel/README b/devel/README
index 312bad9..7d73fdd 100644
--- a/devel/README
+++ b/devel/README
@@ -22,6 +22,9 @@ ifdex-ignores::
 packaging.txt::
 	Guidance for binary package builders.
 
+release::
+	Script dfor shipping a release.
+
 TODO::
 	List of items the NTPsec developers are working on.
 
diff --git a/devel/release b/devel/release
new file mode 100755
index 0000000..4fadeef
--- /dev/null
+++ b/devel/release
@@ -0,0 +1,47 @@
+#!/bin/sh
+# Cut an ntpsec release.  VERSION must contain the correct release number.
+#
+# Run with no arguments to dry-run this.
+
+# Check that we really mean it.
+if [ "$1" = "go" ]
+then
+	do=""
+else
+	do="echo"
+fi
+
+V=`cat ../VERSION`
+UV=`cat ../VERSION | tr '.' '_'`
+
+K=477C7528	# Release manager's GPG key ID
+
+do=echo
+
+# Tag the version
+$do git tag -u ${K} -m "version ${V}" NTPsec_${UV}
+
+# Commit those modifications to the repository.
+$do git commit -Ssecurity@ntpsec.org -s -m "version ${V}"
+
+# Push the repository upstream.
+$do git push  
+$do git push --tags
+
+# Generate release tarball.
+$do git archive --format=tar.gz -v -o ../ntpsec-${V}.tar.gz NTPsec_${UV}
+
+# Generate GPG detached signature of the release tarball.
+$do gpg -u ${K} --output ntpsec-${V}.tar.gz.sig --detach-sig ntpsec-${V}.tar.gz
+
+# Generate sha256sum file for the release tarball.
+$do shasum -a 256 -p ntpsec-${V}.tar.gz >ntpsec-${V}.tar.gz.sum
+
+# GPG sign that sha256sum file.
+$do gpg -u ${K} -a --output ntpsec-${V}.tar.gz.sum.asc ntpsec-${V}.tar.gz.sum
+  
+# Copy the release tarball, GPG detached signature of the release
+# tarball, and the signed sha256sum file to the ftp artifact server.
+$do scp ntpsec-${V}.tar* releasemanager@hostname.ntpsec.org:ftp
+
+# end
-- 
2.7.4

