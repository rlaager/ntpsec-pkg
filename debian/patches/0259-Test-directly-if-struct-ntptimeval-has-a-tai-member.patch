From 84aa4d3cbc13fe90cb3c3a639adcf117a262c53d Mon Sep 17 00:00:00 2001
From: Matt Selsky <matthew.selsky@twosigma.com>
Date: Fri, 9 Dec 2016 23:16:44 -0500
Subject: [PATCH 259/268] Test directly if struct ntptimeval has a tai member

...instead of checking for NTP_API symbol

Fixes GitLab issue #200
---
 libntp/clockwork.c |  6 ++----
 ntptime/ntptime.c  | 10 ++++------
 2 files changed, 6 insertions(+), 10 deletions(-)

diff --git a/libntp/clockwork.c b/libntp/clockwork.c
index b2ee587..745b36c 100644
--- a/libntp/clockwork.c
+++ b/libntp/clockwork.c
@@ -120,11 +120,9 @@ int ntp_gettime(struct ntptimeval *ntv)
 	ntv->time = tntx.time;
 	ntv->maxerror = tntx.maxerror;
 	ntv->esterror = tntx.esterror;
-#  ifdef NTP_API
-#   if NTP_API > 3
+#if defined(STRUCT_NTPTIMEVAL_HAS_TAI)
 	ntv->tai = tntx.tai;
-#   endif
-#  endif
+#endif
 	return result;
 }
 #endif	/* !HAVE_NTP_GETTIME */
diff --git a/ntptime/ntptime.c b/ntptime/ntptime.c
index e4730b2..7289ac9 100644
--- a/ntptime/ntptime.c
+++ b/ntptime/ntptime.c
@@ -60,11 +60,9 @@ int ntp_gettime(struct ntptimeval *ntv)
 	ntv->time = tntx.time;
 	ntv->maxerror = tntx.maxerror;
 	ntv->esterror = tntx.esterror;
-#  ifdef NTP_API
-#   if NTP_API > 3
+#if defined(STRUCT_NTPTIMEVAL_HAS_TAI)
 	ntv->tai = tntx.tai;
-#   endif
-#  endif
+#endif
 	return result;
 }
 #endif	/* !HAVE_NTP_GETTIME */
@@ -355,11 +353,11 @@ main(
 			       (int)time_frac,
 
 			       ctime_r((time_t *)&ntv.time.tv_sec, ascbuf));
-#if defined(STRUCT_NTPTIMEVAL_HAS_TAI) && NTP_API > 3
+#if defined(STRUCT_NTPTIMEVAL_HAS_TAI)
 		printf(json ? jfmt5 : ofmt5, (long)ntv.tai);
 #else
 		printf(json ? jfmt6 : ofmt6);
-#endif /* defined(STRUCT_NTPTIMEVAL_HAS_TAI) && NTP_API */
+#endif /* STRUCT_NTPTIMEVAL_HAS_TAI */
 	}
 	status = ntp_adjtime_ns(&ntx);
 	if (status < 0) {
-- 
2.7.4

